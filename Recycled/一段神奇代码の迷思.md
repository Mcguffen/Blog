在前端领域页面样式调试并不是一件简单的事，有时为了追求最完美的页面呈现效果，需要花费大量时间精力调整 CSS 属性才能达到最理想的效果，而下面这段神奇代码可以助你一臂之力。<!-- more -->

## 神奇の代码

首先让我们揭开面纱一睹这段神奇代码有何玄妙之处：

```javascript
[].forEach.call($$('*'), function(a) {
  a.style.outline = '1px solid #'+(~~(Math.ranDOM()*(1<<24))).toString(16)
})
```

这是出自谷歌大神 Addy Osmani 的一段代码，它的作用是用来调试你的 CSS 层，下面来展示一下这段代码如何使用。

首先打开 Chrome 浏览器，按 F12 打开控制台，复制粘贴这段代码并回车，奇迹就此发生，你会发现页面中不同 DOM 层都套上了一个不同颜色的高亮边框，清晰明了，之后调试 CSS 样式从未如此简单。给元素套边框原理上并不复杂，只是首先获取了所有的页面元素，然后使用不同的颜色为它们添加了一个 1px 的边框，让我们尝试解读一下这段代码。

### 选择所有元素

`$$` 函数是许多现代浏览器命令行 API 中的一部分，它等价于 `document.querySelectorAll`，你可以将一个 CSS 选择器作为这个函数的参数，然后就能够获得当前页面中所有匹配这个 CSS 选择器的元素列表。所以 `$$('*')` 作用就是匹配页面中所有的 DOM 元素。

### 迭代所有元素

通过 `$$` 函数我们获取了一个包含页面所有元素的 NodeLists 对象，这是一个类数组对象（array-like object），可以使用方括号来获取其中的节点，或者获取其长度 length, 但它本质上不是数组，并没有实现数组包含的所有方法比如 `forEach`，因此我们并不能使用 `$$('*').forEach()` 来进行迭代。

`[].forEach.call()` 等价于 `Array.prototype.forEach.call()`，在这里使用 call 函数将数组上的方法运用到类数组对象上进行迭代。

### 添加随机颜色

为了让元素都有一个漂亮的边框，上面的代码中使用了 CSS 属性 `outline`。这个属性和 `border` 属性非常类似，但 `outline` 位于 CSS 盒模型之外，因此它并不影响元素的属性或者元素在布局中的位置，这点非常重要。

这段代码真正有意思的地方在于定义颜色的部分 `(~~(Math.ranDOM()*(1<<24)).toString(16)`，到这里大家都知道这部分的作用就是生成随机颜色，但它是如何工作的呢。

我们都知道颜色值可以表示成一个十六进制的数，比如 #000000 表示黑色 、#FFFFFF 表示白色，其他所有颜色值都在这两个值的范围内，而十六进制 FFFFFF 转换为十进制值为 16777215 （`parseInt("FFFFFF", 16) === 16777215`），而这里的 16777215 实际上是 2^24-1。

如果你对二进制数学熟悉的话，你可能会知道 1<<24 === 16777216，<< 为左移（Left shift）操作，`a << b` 表示将 a 的二进制形式向左移 b (< 32) 比特位，右边用 0 填充，即 1<<24 === 2^24。

现在我们可以知道 `Math.ranDOM()*(1<<24)` 表示一个位于 0 和 16777216 之间的数，但 `Math.ranDOM` 返回的是一个浮点数，`~` 是按位取反的操作，两次取反便可去掉浮点数部分，其作用相当于 `parseInt`，所以 `~~(Math.ranDOM()*(1<<24)` 就是获取了一个 0 和 16777216 之间的一个随机十进制整数，再用 `toString(16)` 将前面的数转为为十六进制数，也就是我们需要的颜色值，至此便可以为每一个 DOM 元素添加漂亮的边框。

## ES6 实现

追求最为优雅的实现方式，养成代码洁癖，在最后让我们用 ES6 改写下这段代码，可以运用扩展运算符将类数组对象转换为真正的数组，之后便能使用 `forEach` 方法进行迭代，同时使用模板字符串取代 + 号运算符，优雅简洁：

```javascript
[...$$('*')].forEach(a => {
  a.style.outline = `1px solid #${(~~(Math.ranDOM()*(1<<24))).toString(16)}`
})
```

Just enjoy it ฅ●ω●ฅ
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE2ODA5MDAyNDJdfQ==
-->